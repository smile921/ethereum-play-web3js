import Ember from 'ember';
import web3 from 'ember-web3/services/web3';
import set from 'ember-metal/set';
import get from 'ember-metal/get';
export default Ember.Component.extend({
    ballotAddr:'0xc1c4334c9209246b5734e53c4014d5699c47f56c',
    ballotAddr2:'0x116395e7c3e4985bb930dc5c8c1b93e92c0ebd73',
    web3: Ember.inject.service(),
    clog:function(){
        console.log(web3);
    },
    ballotIns:{},
    init:function(){
         // debugger
        this._super(...arguments);
        this.errors = []; 
        let ballotAddr = get(this,'ballotAddr2');
        let web3In = get(this,'web3.web3Instance');
        let abi = [{"constant":false,"inputs":[{"name":"proposal","type":"uint256"}],"name":"vote","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"proposals","outputs":[{"name":"name","type":"bytes32"}, {"name":"voteCount","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"chairperson","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"to","type":"address"}],"name":"delegate","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"winningProposal","outputs":[{"name":"winningProposal","type":"uint256"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"voter","type":"address"}],"name":"giveRightToVote","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"voters","outputs":[{"name":"weight","type":"uint256"},{"name":"voted","type":"bool"},{"name":"delegate","type":"address"},{"name":"vote","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"winnerName","outputs":[{"name":"winnerName","type":"bytes32"}],"payable":false,"type":"function"},{"inputs":[{"name":"proposalNames","type":"bytes32[]"}],"payable":false,"type":"constructor"}];
        let bin = 0x6060604052341561000c57fe5b604051610647380380610647833981016040528051015b60008054600160a060020a03191633600160a060020a03908116919091178083551681526001602081905260408220555b81518110156100ca57600280546001810161006f83826100d2565b916000526020600020906002020160005b604060405190810160405280868681518110151561009a57fe5b6020908102909101810151825260009181019190915281518455015160019092019190915550505b600101610054565b5b505061012b565b8154818355818115116100fe576002028160020283600052602060002091820191016100fe9190610104565b5b505050565b61012891905b80821115610124576000808255600182015560020161010a565b5090565b90565b61050d8061013a6000396000f300606060405236156100725763ffffffff60e060020a6000350416630121b93f8114610074578063013cf08b146100895780632e4176cf146100b55780635c19a95c146100e1578063609ff1bd146100ff5780639e7b8d6114610121578063a3ec138d1461013f578063e2ba53f014610189575bfe5b341561007c57fe5b6100876004356101ab565b005b341561009157fe5b61009c600435610221565b6040805192835260208301919091528051918290030190f35b34156100bd57fe5b6100c561024f565b60408051600160a060020a039092168252519081900360200190f35b34156100e957fe5b610087600160a060020a036004351661025e565b005b341561010757fe5b61010f6103a6565b60408051918252519081900360200190f35b341561012957fe5b610087600160a060020a036004351661041a565b005b341561014757fe5b61015b600160a060020a036004351661047e565b604080519485529215156020850152600160a060020a03909116838301526060830152519081900360800190f35b341561019157fe5b61010f6104b2565b60408051918252519081900360200190f35b600160a060020a03331660009081526001602081905260409091209081015460ff16156101d757610000565b6001818101805460ff191690911790556002808201839055815481549091908490811061020057fe5b906000526020600020906002020160005b50600101805490910190555b5050565b600280548290811061022f57fe5b906000526020600020906002020160005b50805460019091015490915082565b600054600160a060020a031681565b600160a060020a033316600090815260016020819052604082209081015490919060ff161561028c57610000565b33600160a060020a031683600160a060020a031614156102ab57610000565b5b600160a060020a03838116600090815260016020819052604090912001546101009004161561030e57600160a060020a03928316600090815260016020819052604090912001546101009004831692331683141561030957610000565b6102ab565b506001818101805460ff1916821774ffffffffffffffffffffffffffffffffffffffff001916610100600160a060020a0386169081029190911790915560009081526020829052604090209081015460ff16156103985781546002828101548154811061037757fe5b906000526020600020906002020160005b50600101805490910190556103a0565b815481540181555b5b505050565b600080805b60025481101561041457816002828154811015156103c557fe5b906000526020600020906002020160005b5060010154111561040b5760028054829081106103ef57fe5b906000526020600020906002020160005b506001015491508092505b5b6001016103ab565b5b505090565b60005433600160a060020a0390811691161415806104545750600160a060020a0381166000908152600160208190526040909120015460ff165b1561045e57610000565b600160a060020a0381166000908152600160208190526040909120555b50565b600160208190526000918252604090912080549181015460029091015460ff8216916101009004600160a060020a03169084565b600060026104be6103a6565b815481106104c857fe5b906000526020600020906002020160005b505490505b905600a165627a7a723058206d390b0925d91c0d73853ae08cb3ee6d7c59d9b4941b79c5b9d05838067be97e0029;
        console.log(bin);
       
        let contract = web3In.eth.contract(abi);
        let ballotIns =  contract.at(ballotAddr);
        set(this,'ballotIns',ballotIns);
        console.log(ballotIns);
        web3In.personal.unlockAccount('0xa50f4f3d0b5f9808c418d51b1017b7451220a737',
                'smile921'/*Config.web3UserPassword*/,999);
    },
    actions:{
        voters:function() {
            let ballotIns = get(this,'ballotIns');
            let voters = ballotIns.voters();
            console.log(voters);
        },
        callnewBallotVote:function(){             
            let ballotIns = get(this,'ballotIns');
            // debugger
            ballotIns.Ballot(['smile921','frere921']);
            
        },
        giveRightToVote:function(){
            let voter = (Ember.$('#voterAddr').val());
            let ballotIns = get(this,'ballotIns');
            // debugger
            let ret = ballotIns.giveRightToVote(voter,{from:'0xa50f4f3d0b5f9808c418d51b1017b7451220a737'});
            console.log(ret);
             
        },
        vote:function(){
            let proposal = parseInt(Ember.$('#proposal').val());
            let ballotIns = get(this,'ballotIns');
            ballotIns.vote(proposal);               
        }
    }
});
